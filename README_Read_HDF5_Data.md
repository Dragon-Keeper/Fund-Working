# 基金HDF5数据读取与分析系统

## 功能概述

基金HDF5数据读取与分析系统是一个专为高效读取、处理和分析基金历史净值数据而设计的工具。该系统能够从HDF5文件中快速提取基金数据，并提供全面的数据查询、统计分析、可视化展示和数据导出功能，帮助用户深入了解基金的历史表现和趋势。

## 系统特点

- **高效数据读取**：使用向量化操作和缓存机制，快速读取大量基金数据
- **全面的统计分析**：预计算多种统计指标，包括收益率、波动率、夏普比率等
- **丰富的可视化功能**：支持交互式净值走势图和统计分析图
- **灵活的数据导出**：支持CSV和Excel格式导出，满足不同分析需求
- **友好的用户界面**：简洁直观的命令行菜单，易于操作

## 主要功能

### 1. 基金数据查询

- **历史净值概览**：查看指定基金的历史净值数据，包括单位净值、累计净值和涨跌幅
- **指定日期查询**：查询特定日期的基金数据
- **基金代码列表**：获取系统中所有可用的基金代码

### 2. 数据统计分析

- **基本统计指标**：最高净值、最低净值、平均净值、标准差等
- **风险收益指标**：年化收益率、年化波动率、夏普比率
- **趋势分析指标**：移动平均线、布林带、RSI等

### 3. 可视化展示

- **交互式净值走势图**：支持线图、K线图、OHLC图等多种图表类型
- **交互式统计分析图**：包含月度收益率分布、净值分布、涨跌幅分布等多个子图

### 4. 数据导出

- **CSV导出**：将基金数据导出为CSV格式
- **Excel导出**：将基金数据导出为Excel格式，包含多个工作表（原始数据、月度数据、年度数据和统计指标）

## 技术实现

### 核心函数

#### 1. 数据读取与管理

- **get_all_fund_codes_indexed()**：获取所有基金代码并创建索引
- **get_fund_data_on_date_vectorized()**：使用向量化操作高效获取指定日期的基金数据
- **calculate_query_hash()**：计算查询哈希值，用于缓存优化

#### 2. 统计分析

- **precompute_statistics()**：预计算基金数据的各种统计指标
  - 净值统计：最高、最低、平均净值等
  - 风险收益指标：年化收益率、年化波动率、夏普比率
  - 技术指标：移动平均线、布林带、RSI等

#### 3. 可视化

- **create_interactive_nav_chart()**：创建交互式净值走势图
  - 支持线图、K线图、OHLC图
  - 支持添加移动平均线、布林带等技术指标
  - 支持图表定制和导出

- **create_interactive_stats_chart()**：创建交互式统计分析图
  - 月度收益率分布图
  - 净值分布图
  - 涨跌幅分布图
  - 收益率时间序列图

#### 4. 数据导出

- **export_to_csv()**：将基金数据导出为CSV格式
- **export_to_excel()**：将基金数据导出为Excel格式，生成包含多个工作表的报表
- **export_chart_to_image()**：将图表导出为图片文件

### 性能优化

- **缓存机制**：使用缓存存储已查询的结果，减少重复计算
- **向量化操作**：使用NumPy和Pandas的向量化操作，提高数据处理效率
- **内存管理**：优化内存使用，避免不必要的数据复制
- **进度显示**：提供进度条显示长时间操作的进度

## 使用方法

### 基本操作流程

1. 运行程序：`python 2.Read_HDF5_Data.py`
2. 系统会自动检查并安装必要的依赖
3. 在主菜单中选择所需功能：

   ```
   基金HDF5数据读取与分析系统
   ------------------------
   请选择操作：
   1. 显示指定基金的历史净值数据概览
   2. 显示指定基金在某一天的数据
   3. 显示指定基金的交互式净值走势图
   4. 显示指定基金的统计分析图
   5. 导出指定基金的数据为CSV文件
   6. 导出指定基金的数据为Excel文件
   7. 显示所有基金代码
   0. 退出系统
   请输入选择: 
   ```

4. 根据提示输入相关参数（如基金代码、查询日期等）
5. 查看结果或导出文件

### 详细功能说明

#### 1. 历史净值数据概览

- 选择菜单选项1
- 输入基金代码（如：161725）
- 系统会显示该基金的历史净值数据概览，包括数据总条数、时间范围、基本统计指标等

#### 2. 指定日期数据查询

- 选择菜单选项2
- 输入基金代码
- 输入查询日期（格式：YYYYMMDD，如：20230101）
- 系统会显示该基金在指定日期的数据

#### 3. 交互式净值走势图

- 选择菜单选项3
- 输入基金代码
- 选择图表类型（线图、K线图或OHLC图）
- 系统会自动生成交互式图表并在浏览器中打开

#### 4. 统计分析图

- 选择菜单选项4
- 输入基金代码
- 系统会自动生成包含多个子图的交互式统计分析图并在浏览器中打开

#### 5. CSV导出

- 选择菜单选项5
- 输入基金代码
- 系统会将数据导出为CSV文件，保存在exports目录下

#### 6. Excel导出

- 选择菜单选项6
- 输入基金代码
- 系统会将数据导出为Excel文件，保存在exports目录下，包含多个工作表

#### 7. 显示所有基金代码

- 选择菜单选项7
- 系统会显示所有可用的基金代码和名称

## 参数说明

### 系统参数

系统中的主要参数包括：

- **h5_file_path**：HDF5文件路径，默认为当前目录下的data/All_Fund_Data.h5
- **cache_dir**：缓存目录，默认为当前目录下的cache
- **exports_dir**：导出文件目录，默认为当前目录下的exports
- **max_cache_size**：最大缓存大小，默认为500MB

### 用户输入参数

通过交互式界面，用户需要提供的参数主要包括：

- **fund_code**：基金代码，用于指定要查询的基金
- **date_str**：日期字符串，格式为YYYYMMDD，用于查询特定日期的数据
- **chart_type**：图表类型，包括'line'（线图）、'candle'（K线图）和'ohlc'（OHLC图）

## 返回值说明

### 数据查询函数返回值

- **get_fund_data_on_date_vectorized()**：返回包含指定日期基金数据的Pandas DataFrame
- **get_all_fund_codes_indexed()**：返回所有基金代码的字典，键为基金代码，值为基金名称

### 统计函数返回值

- **precompute_statistics()**：返回包含多种统计指标的字典
  - 包括基本统计指标、风险收益指标、技术指标等

### 可视化函数返回值

- **create_interactive_nav_chart()**：返回Plotly图表对象
- **create_interactive_stats_chart()**：返回Plotly图表对象

## 注意事项

1. **数据文件准备**：确保HDF5数据文件存在（通常是All_Fund_Data.h5）
2. **依赖安装**：系统会自动检查并安装必要的依赖，但在网络受限环境下可能需要手动安装
3. **内存要求**：处理大量基金数据时，建议系统至少有4GB内存
4. **可视化环境**：图表显示功能依赖于浏览器环境，确保默认浏览器可用
5. **缓存管理**：系统会自动管理缓存，但长期使用后可能需要手动清理cache目录
6. **导出目录**：首次导出时，系统会自动创建exports目录

## 常见问题与解决方案

### 1. 无法找到HDF5文件

- 确保HDF5数据文件位于正确的位置
- 可以修改代码中的h5_file_path变量指定正确的文件路径
- 如果没有HDF5文件，可以先运行2.TDX_To_HDF5.py生成

### 2. 可视化图表无法显示

- 检查浏览器是否正常工作
- 确保Plotly库正确安装
- 尝试更新Plotly库：`pip install --upgrade plotly`

### 3. 内存不足错误

- 减少同时处理的基金数量
- 增加系统内存
- 清理系统临时文件和缓存

## 系统要求

- **Python版本**：Python 3.6或更高版本
- **依赖库**：
  - pandas：数据处理
  - numpy：数值计算
  - h5py：HDF5文件操作
  - plotly：交互式图表创建
  - openpyxl：Excel文件操作
  - tqdm：进度条显示

## 扩展与自定义

系统设计考虑了扩展性，可以通过以下方式进行自定义：

1. **添加新的统计指标**：在precompute_statistics函数中添加新的计算逻辑
2. **扩展可视化功能**：修改create_interactive_nav_chart和create_interactive_stats_chart函数
3. **支持更多数据格式**：添加新的导出函数支持其他数据格式
4. **自定义界面**：修改main函数中的菜单逻辑

## 联系与支持

如有任何问题或建议，请通过以下方式联系开发者：

- 邮箱：[example@domain.com]
- GitHub：[GitHub仓库链接]

---

© 2023 基金HDF5数据读取与分析系统 - 保留所有权利