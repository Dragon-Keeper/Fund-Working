# 货币基金数据获取与查询工具

## 项目简介

本工具使用Playwright库从东方财富网爬取货币型基金的交易数据，并将数据存储在HDF5格式的数据库中。工具提供下载所有货币基金数据和查询特定基金数据的功能，帮助用户快速获取和分析货币基金信息。

## 文件结构

- `fetch_currency_fund_data.py`：主程序文件，实现数据爬取、存储和查询功能
- `data/Currency_Fund_Data.h5`：HDF5格式的数据文件，存储货币基金数据
- `README_fetch_currency_fund_data.md`：本说明文件

## 主要功能

1. **数据爬取**：从东方财富网自动爬取货币基金的最新交易数据
2. **数据存储**：将爬取的数据存储在HDF5格式的数据库中
3. **数据查询**：根据基金代码查询特定货币基金的详细信息
4. **交互式菜单**：提供友好的命令行菜单，方便用户操作

## 技术特点

1. **自动化爬取**：使用Playwright库实现浏览器自动化，模拟人工访问和数据提取
2. **高效存储**：采用HDF5格式存储数据，支持快速读写和数据压缩
3. **错误处理**：完善的异常捕获和错误处理机制，确保程序稳定运行
4. **无头模式**：支持无头浏览器模式，减少资源占用
5. **数据完整**：包含基金代码、名称、万份收益、7日年化、成立日期、基金经理、手续费等关键数据

## 安装与依赖

### 基础环境
- Python 3.7+ 

### 安装依赖

```bash
pip install playwright pandas h5py
playwright install
```

## 使用方法

1. 运行主程序：

```bash
python fetch_currency_fund_data.py
```

2. 根据菜单选择功能：
   - 选择1：下载所有货币基金数据
   - 选择2：查询特定货币基金数据
   - 选择0：退出程序

3. 查询功能使用：
   - 选择功能2后，输入要查询的货币基金代码（如：003399）
   - 程序将显示该基金的详细信息

## 数据字段说明

| 字段名称 | 字段含义 | 数据类型 |
|---------|---------|---------|
| fund_code | 基金代码 | 字符串 |
| fund_name | 基金名称 | 字符串 |
| latest_yield | 最新万份收益 | 浮点数 |
| latest_annual | 最新7日年化收益率(%) | 浮点数 |
| establish_date | 基金成立日期 | 字符串(YYYY-MM-DD) |
| manager | 基金经理姓名 | 字符串 |
| fee | 交易手续费 | 浮点数 |
| update_date | 数据更新日期 | 字符串(YYYY-MM-DD) |
| fetch_time | 数据获取时间 | 字符串(YYYY-MM-DD HH:MM:SS) |

## 配置说明

在 `fetch_currency_fund_data.py` 文件中可以修改以下配置：

```python
# HDF5文件存储路径
HDF5_PATH = os.path.join(os.path.dirname(os.path.abspath(__file__)), "data", "Currency_Fund_Data.h5")

# 目标网站URL
URL = "http://fund.eastmoney.com/HBJJ_dwsy.html"
```

## 注意事项

1. **网络连接**：使用前请确保网络连接正常，能够访问东方财富网

2. **首次运行**：首次运行需要下载Playwright浏览器，可能需要一些时间

3. **数据更新频率**：建议定期更新数据以获取最新的基金信息

4. **错误处理**：如遇到数据获取失败，请检查网络连接或尝试重新运行程序

5. **浏览器模式**：如需查看浏览器操作过程，可以将代码中的 `headless=True` 改为 `headless=False`

## 常见问题

**Q: 运行程序时提示缺少依赖包怎么办？**
A: 请确保已安装所有必需的依赖包，可以使用以下命令安装：
```bash
pip install playwright pandas h5py
playwright install
```

**Q: 数据爬取速度很慢怎么办？**
A: 数据爬取速度受网络环境影响，请耐心等待。如需加快速度，可以确保网络连接稳定。

**Q: 查询基金数据时提示未找到怎么办？**
A: 请检查基金代码是否正确，或者尝试先运行下载功能获取最新数据。

**Q: HDF5文件在哪里？**
A: HDF5文件位于程序同级目录的data文件夹中，文件名为`Currency_Fund_Data.h5`。

## 更新日志

**v1.1.0** (2024-09-24)
- 修复了基金名称和基金经理信息的中文字符存储问题
- 优化了正则表达式实现，确保能正确提取基金名称、基金经理和7日年化收益率
- 改进了数据解析逻辑，添加双重匹配机制提高提取成功率
- 解决了部分基金数据字段为空的问题

**v1.0.0** (2024-09-23)
- 初始版本发布
- 实现货币基金数据的自动爬取功能
- 实现HDF5格式数据存储
- 提供基金数据查询功能
- 添加交互式菜单系统
- 完善错误处理机制