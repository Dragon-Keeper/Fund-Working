# 场内交易基金数据爬取工具

## 功能介绍

本脚本用于爬取和管理场内交易基金（FBS - Fund Board Stock）的排名数据。通过使用Playwright库进行网页自动化操作，脚本可以从指定的金融网站获取最新的场内交易基金数据，并将其存储到HDF5文件中以便后续查询和分析。

## 主要功能

- **批量下载**：自动爬取所有场内交易基金的最新数据
- **数据查询**：根据基金代码查询具体基金的详细信息
- **数据存储**：将爬取的基金数据保存到HDF5文件中
- **字段完整**：包含16个关键数据字段，涵盖基金基本信息和各类收益率数据

## 依赖环境

在运行本脚本之前，请确保已安装以下依赖库：

```
playwright
asyncio
h5py
numpy
re
```

可以使用pip安装这些依赖：

```bash
pip install playwright asyncio h5py numpy
```

此外，还需要安装Playwright的浏览器驱动：

```bash
playwright install
```

## 使用方法

1. **运行脚本**：
   
   ```bash
   python fetch_fbs_fund_ranking.py
   ```

2. **功能选择**：
   
   脚本运行后会显示菜单，您可以选择以下功能：
   - 输入 `1` 下载所有场内交易基金数据
   - 输入 `2` 查询特定场内交易基金数据
   - 输入 `0` 退出程序

3. **数据查询**：
   
   选择查询功能后，输入6位基金代码（如`588890`），系统将显示该基金的详细信息。

## 数据字段说明

脚本会获取并存储以下16个字段的数据：

| 序号 | 字段名称 | 说明 |
|------|---------|------|
| 1 | 基金代码 | 6位数字代码，如588890 |
| 2 | 基金简称 | 基金的中文简称 |
| 3 | 基金类型 | 基金的类型分类 |
| 4 | 最新日期 | 数据更新的最新日期（从表格单元格中基金类型后的下一位数据提取） |
| 5 | 最新单位净值 | 基金的最新单位净值 |
| 6 | 最新累计净值 | 基金的最新累计净值 |
| 7 | 近1周增长率 | 最近一周的收益率 |
| 8 | 近1月增长率 | 最近一个月的收益率 |
| 9 | 近3月增长率 | 最近三个月的收益率 |
| 10 | 近6月增长率 | 最近六个月的收益率 |
| 11 | 近1年增长率 | 最近一年的收益率 |
| 12 | 近2年增长率 | 最近两年的收益率 |
| 13 | 近3年增长率 | 最近三年的收益率 |
| 14 | 今年来增长率 | 从年初至今的收益率 |
| 15 | 成立来增长率 | 基金成立以来的总收益率 |
| 16 | 成立日期 | 基金的成立日期 |

### 数据提取规则补充说明

- 每行表格包含18个单元格，从第三个单元格（索引为2，从0开始计数）开始提取数据
- 提取后的数据按以下顺序依次对应各信息项：基金代码、基金简称、基金类型、最新日期、最新单位净值、最新累计净值、近1周增长率、近1月增长率、近3月增长率、近6月增长率、近1年增长率、近2年增长率、近3年增长率、今年来增长率、成立来增长率、成立日期

## 数据存储

- **存储位置**：数据保存在 `data/FBS_Fund_Ranking_Data.h5` 文件中
- **存储格式**：使用HDF5格式存储，便于高效读写和查询
- **数据更新**：每次下载会覆盖原有的数据文件

## 注意事项

1. **网络连接**：确保您的网络连接正常，以便能够访问金融网站获取数据
2. **浏览器驱动**：首次运行前请确保已正确安装Playwright浏览器驱动
3. **数据时效性**：数据更新频率取决于金融网站的更新频率，建议定期运行脚本获取最新数据
4. **错误处理**：脚本包含异常处理机制，遇到问题会自动跳过或提示

## 常见问题

### Q: 运行脚本时提示"list index out of range"错误怎么办？

A: 这通常是由于网页结构变化导致的。脚本已经实现了安全的单元格访问机制，可以自动处理此类问题。如果问题持续存在，请检查网络连接或稍后再试。

### Q: 为什么查询某些基金代码时提示"未找到数据"？

A: 可能的原因有：
1. 该基金不是场内交易基金
2. 基金代码输入错误
3. 该基金不在爬取范围内

### Q: 如何修改数据存储路径？

A: 可以在脚本中修改 `HDF5_PATH` 变量来更改数据存储路径。

## 免责声明

本工具仅用于学习和研究目的，数据仅供参考，不构成任何投资建议。使用本工具获取的数据请自行核实其准确性。