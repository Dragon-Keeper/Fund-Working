# 开放型基金数据提取与查询工具

## 项目简介

这是一个用于提取和查询开放型基金各项排行数据的Python工具。该工具基于Playwright库实现网页数据爬取，能够从东方财富网提取开放型基金的详细排行数据，并将其存储到HDF5格式的数据库中，同时提供查询功能。

## 文件结构

```
├── fetch_open_fund_ranking.py  # 主程序文件
├── README_fetch_open_fund_ranking.md  # 项目说明文档
└── data/  # 数据存储目录
    └── Open_Fund_Ranking_Data.h5  # HDF5格式的基金数据文件
```

## 主要功能

1. **数据下载**：自动遍历所有页面，提取开放型基金的各项排行数据
2. **数据存储**：将提取的数据保存到HDF5格式的数据库中
3. **数据查询**：支持根据基金代码查询并显示基金的详细信息

## 技术特点

- 使用**Playwright**库进行网页数据爬取，支持异步操作
- 采用**正则表达式**解析HTML，提取结构化数据
- 使用**HDF5**格式存储基金数据，支持高效的数据读写
- 实现了友好的**菜单交互系统**，方便用户操作
- 具备完善的**错误处理**机制，确保程序稳定运行

## 安装依赖

在运行程序前，请确保安装了以下Python依赖库：

```bash
pip install asyncio playwright h5py pandas
```

另外，还需要安装Playwright的浏览器驱动：

```bash
playwright install
```

## 使用方法

### 基本使用

1. 在命令行中运行程序：
   ```bash
   python fetch_open_fund_ranking.py
   ```

2. 程序启动后，会显示如下菜单：
   ```
   ===== 开放型基金数据管理系统 ======
   1. 下载所有开放型基金数据
   2. 查询开放型基金数据
   3. 退出
   ```

3. 输入数字选择对应的功能：
   - 选择**1**：开始下载所有开放型基金数据，数据将保存到data/Open_Fund_Ranking_Data.h5文件中
   - 选择**2**：输入基金代码，查询并显示该基金的详细信息（不包含手续费字段）
   - 选择**0**：退出程序

### 首次使用提示

- 首次使用时，程序会自动创建data目录和HDF5文件
- 首次下载数据时，可能需要一定时间，取决于网络速度和基金数量
- 查询功能需要先下载数据才能正常使用

## 数据字段说明

程序提取的开放型基金数据包含以下字段：

| 字段名称 | 字段描述 | 数据类型 |
|---------|---------|---------|
| fund_code | 基金代码 | 字符串 |
| fund_name | 基金简称 | 字符串 |
| data_date | 数据获取日期 | 字符串 |
| unit_nav | 最新单位净值 | 数值或"---" |
| accum_nav | 最新累计净值 | 数值或"---" |
| day_growth | 日增长率 | 百分比数值或"---" |
| week_growth | 近1周增长率 | 百分比数值或"---" |
| month_growth | 近1月增长率 | 百分比数值或"---" |
| quarter_growth | 近3月增长率 | 百分比数值或"---" |
| half_year_growth | 近6月增长率 | 百分比数值或"---" |
| year_growth | 近1年增长率 | 百分比数值或"---" |
| two_year_growth | 近2年增长率 | 百分比数值或"---" |
| three_year_growth | 近3年增长率 | 百分比数值或"---" |
| year_to_date_growth | 今年来增长率 | 百分比数值或"---" |
| since_establishment_growth | 成立来增长率 | 百分比数值或"---" |
| custom_growth | 自定义增长率（使用近1年增长率值） | 百分比数值或"---" |
| fee | 手续费（内部存储但不显示） | 百分比数值 |
| fetch_time | 数据获取时间 | 字符串 |

## 配置说明

程序的主要配置位于文件开头的全局变量部分：

```python
# 全局配置
HDF5_PATH = os.path.join(os.path.dirname(os.path.abspath(__file__)), "data", "Open_Fund_Ranking_Data.h5")
URL = "http://fund.eastmoney.com/data/fundranking.html"
```

- **HDF5_PATH**：指定HDF5数据文件的存储路径
- **URL**：指定爬取数据的网页地址

## 注意事项

1. 请确保您的网络连接正常，程序需要访问互联网获取数据
2. 数据仅供参考，实际投资决策请以官方数据为准
3. 程序设计为单线程操作，大量数据处理可能需要一定时间
4. 如果网页结构发生变化，可能导致数据提取失败，需要更新正则表达式
5. 运行过程中如果遇到问题，请查看控制台输出的错误信息

## 常见问题

**Q: 为什么下载数据时提示"未获取到任何开放型基金数据"？**
A: 这可能是由于网络问题或网页结构变化导致的。请检查网络连接，并确认目标网页可以正常访问。

**Q: 查询基金数据时，某些字段显示为"---"是什么意思？**
A: "---"表示该字段没有可用数据或数据无法获取。

**Q: 程序运行缓慢是什么原因？**
A: 程序需要访问网页并处理大量数据，尤其是在下载所有基金数据时，可能需要较长时间。请耐心等待。

## 更新日志

### v1.0.1 (2024-xx-xx)
- 更新数据字段映射逻辑
- 自定义字段使用近1年增长率值
- 移除系统界面中手续费的显示
- 优化代码结构，移除特定基金的专门调试逻辑

### v1.0.0 (2024-xx-xx)
- 首次发布
- 实现开放型基金数据的自动下载和存储功能
- 支持按基金代码查询数据
- 添加了友好的菜单交互系统

## 版权声明

本工具仅供学习和研究使用，请勿用于商业用途。对于使用本工具产生的任何问题，作者不承担任何责任。