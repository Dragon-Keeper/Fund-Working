# 基金量化分析报表生成器

## 功能概述

本程序用于生成基金量化分析Excel报表，包含以下17个表头字段（已添加单位信息）：
- 基金代码
- 基金简称
- 基金类型
- 期初日期
- 期末日期
- 基金规模(亿元)
- 成立年数(年)
- 上涨季度比例%
- 上涨月份比例%
- 上涨星期比例%
- 封闭类型
- 封闭长度
- 状态
- 基金买卖信息
- 基金经理人
- 成立来分红(元)
- 最近更新日期

所有数值类型数据均保留两位小数，百分比类型数据已添加%符号。

## 数据来源

程序从以下HDF5数据库文件中获取数据：

1. **基金基本信息**：`data/Fund_Purchase_Status.h5`
   - 包含基金代码、基金简称、基金类型、申购状态、赎回状态、下一开放日等信息

2. **基金基本面数据**：`data/Fund_Fundamental_Overview.h5`
   - 包含成立日期、资产规模、基金经理人、成立来分红、数据日期等信息

3. **基金净值数据**：`data/All_Fund_Data.h5`
   - 包含各基金的历史净值数据，用于计算上涨比例指标

## 核心计算方法

### 上涨比例计算

1. **上涨季度比例**：统计分析期间内，季度收益率为正的季度数占总季度数的百分比
2. **上涨月份比例**：统计分析期间内，月度收益率为正的月份数占总月份数的百分比
3. **上涨星期比例**：统计分析期间内，周度收益率为正的周数占总周数的百分比

### 其他指标映射

- **封闭类型**：根据申购状态、赎回状态和下一开放日映射
- **封闭长度**：根据下一开放日与当前日期的差值计算
- **状态**：根据申购状态和赎回状态映射
- **基金买卖信息**：整合申购状态、赎回状态、下一开放日、购买起点、日累计限定金额、手续费等信息
- **成立年数**：通过成立日期与当前日期计算得出

##### 性能优化

1. **HDF5文件优化**：一次性打开`All_Fund_Data.h5`文件，减少IO开销
2. **智能多线程处理**：使用ThreadPoolExecutor并行处理多个基金的数据，并根据CPU核心数和基金数量自动选择最佳线程数：
   - 少量基金(≤10)时最多使用4个线程
   - 中等数量(≤50)时使用更多线程
   - 大量基金时使用根据CPU核心数计算的最优线程数
3. **错误处理**：完善的异常处理机制，确保单个基金数据错误不影响整体报表生成
4. **测试模式**：提供快速测试模式，仅处理少量基金数据，便于调试和验证功能

## 使用方法

### 交互式模式

直接运行程序，按照提示输入日期，并选择操作类型：

```bash
python fund_quant_analysis_report.py
```

交互菜单提供以下选项：
1. 生成完整的量化基金分析报表（默认处理前100只基金）
2. 生成5个基金的量化报表测试程序（用于快速测试）

### 非交互式模式

使用命令行参数指定日期范围和输出文件：

```bash
python fund_quant_analysis_report.py --non-interactive --start-date 2023-01-01 --end-date 2024-01-01 --output 我的基金分析报表.xlsx
```

命令行参数说明：
- `--non-interactive`：启用非交互式模式
- `--start-date`：期初日期，格式：YYYY-MM-DD
- `--end-date`：期末日期，格式：YYYY-MM-DD
- `--output`：输出文件名（可选）

## 输出结果

报表将生成在`reports`目录下，文件名格式为`基金量化分析报表_YYYYMMDD_HHMMSS.xlsx`。

## 依赖包

本程序依赖以下Python包：
- pandas
- numpy
- h5py
- matplotlib
- tqdm
- openpyxl

可以使用以下命令安装依赖：

```bash
pip install -r requirements.txt
```

## 注意事项

1. 请确保`data`目录下存在必要的HDF5数据文件
2. 程序会自动跳过数据不完整的基金
3. 如果`All_Fund_Data.h5`文件不存在，上涨比例相关字段将显示为空
4. 对于大规模数据分析，建议适当调整线程数以获得最佳性能

## 扩展建议

1. 可以添加更多的量化指标，如波动率、最大回撤、夏普比率等
2. 增加基金筛选功能，支持按基金类型、规模等条件过滤
3. 添加可视化图表生成功能，如净值走势、收益率分布等
4. 实现定期自动更新数据和生成报表的功能